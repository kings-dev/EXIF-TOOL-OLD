<Window x:Class="Hui_WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Hui_WPF"
        mc:Ignorable="d"
        Title="ExifDog - EXIF or Video Tool" Height="1155" Width="1545"
        AllowDrop="True" DragEnter="Window_DragEnter" Drop="Window_Drop"
        Closing="Window_Closing" MinWidth="840" MinHeight="700"
        Loaded="Window_Loaded"
        PreviewKeyDown="Window_PreviewKeyDown"
        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
    <!-- Use system background -->


    <Window.Resources>

        <!-- Default Margin for consistent spacing -->
        <Thickness x:Key="ControlMargin">0,3,0,3</Thickness>
        <Thickness x:Key="GroupMargin">0,0,10,0</Thickness>
        <Thickness x:Key="SectionMargin">0,10,0,5</Thickness>
        <Thickness x:Key="InnerGroupPadding">10,8</Thickness>
        <CornerRadius x:Key="ControlCornerRadius">3</CornerRadius>

        <!-- Base Button Style -->
        <Style x:Key="BaseButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="Margin" Value="{StaticResource ControlMargin}"/>
            <Setter Property="MinWidth" Value="80"/>
            <Setter Property="MinHeight" Value="26"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="{StaticResource ControlCornerRadius}"
                                SnapsToDevicePixels="True">
                            <ContentPresenter x:Name="contentPresenter" Focusable="False"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              Margin="{TemplateBinding Padding}"
                                              RecognizesAccessKey="True"
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FFBEE6FD"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#FF3C7FB1"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FFC4E5F6"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#FF2C628B"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Opacity" Value="0.6"/>
                                <Setter Property="Cursor" Value="Arrow"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Background" Value="#FFDDDDDD"/>
            <Setter Property="BorderBrush" Value="#FF707070"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
        </Style>

        <!-- Specific Button Styles -->
        <Style x:Key="BrowseButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}"/>
        <Style x:Key="SelectButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Width" Value="130"/>
            <Setter Property="Margin" Value="0,5,0,5"/>
        </Style>
        <Style x:Key="StartProcessingButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Height" Value="45"/>
            <Setter Property="Width" Value="150"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Background" Value="#FF20B2AA"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FF1A8A8A"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF25C8BD"/>
                    <Setter Property="BorderBrush" Value="#FF1A8A8A"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#FF1EAE9F"/>
                    <Setter Property="BorderBrush" Value="#FF147870"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="GenerateButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Height" Value="45"/>
            <Setter Property="Width" Value="150"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Background" Value="DarkSlateBlue"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#FF3A2D6C"/>
            <Setter Property="Margin" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF5C4B9A"/>
                    <Setter Property="BorderBrush" Value="#FF3A2D6C"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#FF483D8B"/>
                    <Setter Property="BorderBrush" Value="#FF2D235A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- GroupBox Style -->
        <Style TargetType="GroupBox">
            <Setter Property="Padding" Value="{StaticResource InnerGroupPadding}"/>
            <Setter Property="Margin" Value="{StaticResource GroupMargin}"/>
            <Setter Property="BorderBrush" Value="LightGray"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlLightLightBrushKey}}"/>
            <!-- Light background -->
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" FontWeight="SemiBold" FontSize="13" Margin="0,0,0,3"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Option Control Styles -->
        <Style x:Key="OptionLabelStyle" TargetType="Label">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,5,0"/>
            <!-- Right margin only -->
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style x:Key="OptionCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="{StaticResource ControlMargin}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <Style x:Key="OptionTextBoxStyle" TargetType="TextBox">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="{StaticResource ControlMargin}"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="MinWidth" Value="80"/>
            <Setter Property="Padding" Value="3,0"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="{StaticResource ControlMargin}"/>
            <Setter Property="Height" Value="26"/>
            <Setter Property="MinWidth" Value="100"/>
        </Style>
        <Style TargetType="Separator">
            <Setter Property="Margin" Value="0,8"/>
        </Style>

        <!-- Style for the Drag/Drop Border -->
        <Style x:Key="DropBorderStyle" TargetType="Border">
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Background" Value="#FFE8E8E8"/>
            <Setter Property="Margin" Value="0,5,0,5"/>
            <Setter Property="AllowDrop" Value="True"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <!-- Could add a subtle effect, but text is primary indicator -->
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style for the Drag/Drop TextBlock -->
        <Style x:Key="DropTextStyle" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="DimGray"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Normal"/>
        </Style>

        <!-- Style for Input Path TextBox Border -->
        <Style x:Key="InputPathBorderStyle" TargetType="Border">
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="CornerRadius" Value="{StaticResource ControlCornerRadius}"/>
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
            <Setter Property="AllowDrop" Value="True"/>
            <Setter Property="Margin" Value="0,0,5,0"/>
        </Style>
        <Style x:Key="InputPathTextBoxStyle" TargetType="TextBox">
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="AllowDrop" Value="True"/>
            <Setter Property="Padding" Value="5,0"/>
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="MinWidth" Value="200"/>
        </Style>
        <Color x:Key="GradientStopColor1">#FF4F4F4F</Color>


    </Window.Resources>

    <Grid Margin="10" Grid.IsSharedSizeScope="True">
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Row 0: Input Path -->
            <RowDefinition Height="395"/>
            <RowDefinition Height="175"/>
            <RowDefinition Height="299.03"/>
            <!-- Row 1: Main Options -->
            <!-- Row 2: Custom Backup -->
            <!-- Row 3: Custom Image Output -->
            <!-- Row 4: Custom Video Output -->
            <!-- Row 5: Drop Area -->
            <RowDefinition Height="Auto"/>
            <!-- Row 6: Progress Bar -->
            <RowDefinition Height="Auto"/>
            <!-- Row 7: Log Label -->
            <RowDefinition Height="150"/>
            <!-- Row 8: Log Area -->
            <RowDefinition Height="Auto"/>
            <!-- Row 9: Status Bar -->
        </Grid.RowDefinitions>

        <!-- Row 0: Input Path, Browse Button, Language Dropdown -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto" SharedSizeGroup="BrowseButtonGroup"/>
                <ColumnDefinition Width="Auto" SharedSizeGroup="LastControlGroup"/>
            </Grid.ColumnDefinitions>
            <Border x:Name="pnlDragDrop" Style="{StaticResource InputPathBorderStyle}" Grid.Column="0" DragEnter="Panel_DragEnter" DragLeave="Panel_DragLeave" Drop="Panel_DragDrop">
                <TextBox x:Name="txtFolderPath" Style="{StaticResource InputPathTextBoxStyle}" Text="未选择文件夹/源图片" TextChanged="TxtFolderPath_TextChanged" GotFocus="TxtFolderPath_GotFocus" LostFocus="TxtFolderPath_LostFocus" DragEnter="TextBox_DragEnter" Drop="TextBox_DragDrop" />
            </Border>
            <Button x:Name="btnBrowseFolder" Style="{StaticResource BrowseButtonStyle}" Grid.Column="1" Content="浏览..." Click="BtnBrowseFolder_Click" Margin="0,0,5,0"/>
            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                <ComboBox x:Name="cmbLanguage" Width="80" Margin="0,0,5,0" SelectionChanged="CmbLanguage_SelectionChanged"/>
            </StackPanel>
        </Grid>



        <!-- Row 1: Main Options -->
        <Grid Grid.Row="1" Margin="2,2,2,2" ShowGridLines="True">
            <!-- Added top margin -->
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="17.591"/>
                <ColumnDefinition Width="138.175"/>
                <ColumnDefinition Width="250.334"/>
                <ColumnDefinition Width="359.753"/>
                <ColumnDefinition Width="198.809"/>
                <ColumnDefinition Width="356.572"/>
                <ColumnDefinition Width="1.87"/>
                <ColumnDefinition Width="0"/>
                <ColumnDefinition Width="549.896"/>
                <!-- Col 0: Select Buttons -->
                <!-- Col 1: Rename/Backup Options -->
                <!-- Col 2: Video/Animation Options -->
                <!-- Col 3: Start Buttons -->
            </Grid.ColumnDefinitions>

            <!-- Col 0: Select Buttons -->
            <GroupBox Header="创建目录选项" Margin="-1,5,11,0" Grid.ColumnSpan="3">
                <!-- 使用更标准的边距，或者根据需要调整 -->

                <Grid Height="340">
                    <!-- 暂时保留固定高度，但可以考虑移除或设为 MinHeight -->
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <!-- 左侧输入区域，宽度根据内容自适应 -->
                        <ColumnDefinition Width="*" />
                        <!-- 右侧预览区域，占据剩余空间 -->
                    </Grid.ColumnDefinitions>

                    <!-- 左侧：输入区域 -->
                    <StackPanel Grid.Column="0" Margin="10">
                        <!-- 为整个 StackPanel 设置一个边距 -->
                        <Button Content="📂 选择根目录" Margin="0,5" Click="SelectFolder_Click" Foreground="#FF091C02" Background="#FFFFEC00" FontWeight="Bold" BorderBrush="#FFF3DFDF" Height="25" IsCancel="True" IsDefault="True" />
                        <TextBlock Text="根目录路径：" />
                        <!-- "粘贴" 复制路径-->
                        <TextBox x:Name="BasePathBox" Margin="0,5,0,10" TextChanged="DirectoryConfig_TextChanged" Text="请选择文件夹或粘贴路径到这" FontSize="9" />

                        <TextBlock Text="根目录前缀：" />
                        <TextBox x:Name="PrefixBox" Text="IMG" Margin="0,5" TextChanged="DirectoryConfig_TextChanged"/>

                        <TextBlock Text="数量：" />
                        <TextBox x:Name="CountBox" Text="2" Margin="0,5"  TextChanged="DirectoryConfig_TextChanged"/>

                        <CheckBox x:Name="RecursiveCheck" Content="生成子目录" IsChecked="True" Margin="0,5,0,15" Checked="DirectoryConfig_InputChanged" Unchecked="DirectoryConfig_InputChanged" />

                        <Button x:Name="GenerateButton"
                Content="生成根/子目录"
                Click="Generate_Click"
                Margin="0,5" Background="#FFFFFAB1" FontWeight="Bold" BorderBrush="{x:Null}" Height="28" />
                    </StackPanel>

                    <!-- 右侧：预览区域 -->
                    <TreeView
                        Grid.Column="1"
                        x:Name="PreviewTree"
                        Margin="10,10,5,12"
                        FontSize="9" />
                </Grid>
            </GroupBox>

            <GroupBox x:Name="gbRenameBackup" Header="EXIF/重命名选项" RenderTransformOrigin="0.5,0.5" Margin="3,0,3,0" Grid.Column="3">
                <GroupBox.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform/>
                        <SkewTransform/>
                        <RotateTransform/>
                        <TranslateTransform/>
                    </TransformGroup>
                </GroupBox.RenderTransform>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <CheckBox x:Name="chkRenameFoldersOnly" Style="{StaticResource OptionCheckBoxStyle}" Content="仅命名目录 (_O)" Grid.Row="0" Grid.Column="0" Checked="RenamingOnly_CheckedChanged" Unchecked="RenamingOnly_CheckedChanged" Background="#FFDBE620"/>
                    <StackPanel Orientation="Horizontal" Grid.Row="0" Grid.Column="1" VerticalAlignment="Center">
                        <Label x:Name="lblBackupPrefix" Style="{StaticResource OptionLabelStyle}" Content="备份或目录前缀:"/>
                        <TextBox x:Name="txtBackupPrefix" Style="{StaticResource OptionTextBoxStyle}" Text="Backup_" Width="Auto" Background="#FFE5F19B"/>
                    </StackPanel>

                    <CheckBox x:Name="chkRenameFilesOnly" Style="{StaticResource OptionCheckBoxStyle}" Content="仅命名文件 (_N)" Grid.Row="1" Grid.Column="0" Checked="RenamingOnly_CheckedChanged" Unchecked="RenamingOnly_CheckedChanged" Background="#FF1AD437"/>
                    <StackPanel Orientation="Horizontal" Grid.Row="1" Grid.Column="1" VerticalAlignment="Center">
                        <Label x:Name="lblRenamePrefix" Style="{StaticResource OptionLabelStyle}" Content="命名源文件前缀:"/>
                        <TextBox x:Name="txtRenamePrefix" Style="{StaticResource OptionTextBoxStyle}" Text="JYH_" Width="Auto" Background="#FF8CDA85"/>
                    </StackPanel>

                    <CheckBox x:Name="chkEnableTimestamp" Style="{StaticResource OptionCheckBoxStyle}" Content="启用时间戳" Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" IsChecked="True" Checked="ChkEnableTimestamp_CheckedChanged" Unchecked="ChkEnableTimestamp_CheckedChanged" Background="#FF16CA31"/>
                    <Label x:Name="lblTimestampFormat" Style="{StaticResource OptionLabelStyle}" Content="时间戳格式:" Target="{Binding ElementName=txtTimestampFormat}" Grid.Row="3" Grid.Column="0" Margin="15,3,5,3"/>
                    <TextBox x:Name="txtTimestampFormat" Style="{StaticResource OptionTextBoxStyle}" Text="yyyyMMdd_HHmm_" Grid.Row="3" Grid.Column="1" IsEnabled="{Binding IsChecked, ElementName=chkEnableTimestamp}"/>

                    <CheckBox x:Name="chkEnableCounter" Style="{StaticResource OptionCheckBoxStyle}" Content="启用计数器" Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2" IsChecked="True" Checked="ChkEnableCounter_CheckedChanged" Unchecked="ChkEnableCounter_CheckedChanged" Background="#FF15D632"/>
                    <Label x:Name="lblCounterStartValue" Style="{StaticResource OptionLabelStyle}" Content="计数器起始值:" Target="{Binding ElementName=txtCounterStartValue}" Grid.Row="5" Grid.Column="0" Margin="15,3,5,3"/>
                    <TextBox x:Name="txtCounterStartValue" Style="{StaticResource OptionTextBoxStyle}" Text="1" Grid.Row="5" Grid.Column="1" IsEnabled="{Binding IsChecked, ElementName=chkEnableCounter}"/>
                    <Label x:Name="lblCounterFormat" Style="{StaticResource OptionLabelStyle}" Content="计数器格式:" Target="{Binding ElementName=txtCounterFormat}" Grid.Row="6" Grid.Column="0" Margin="15,3,5,3"/>
                    <TextBox x:Name="txtCounterFormat" Style="{StaticResource OptionTextBoxStyle}" Text="D2" Grid.Row="6" Grid.Column="1" IsEnabled="{Binding IsChecked, ElementName=chkEnableCounter}" Margin="0,3,0,8"/>
                    <!-- Added bottom margin -->

                    <CheckBox x:Name="chkEnableBackup" Style="{StaticResource OptionCheckBoxStyle}" Content="启用备份 (_B)" Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2" IsChecked="True" HorizontalAlignment="Left" Checked="ChkEnableBackup_CheckedChanged" Unchecked="ChkEnableBackup_CheckedChanged" Background="#FF13DC1F"/>
                    <CheckBox x:Name="chkDisableBackup" Style="{StaticResource OptionCheckBoxStyle}" Content="禁用备份 (_D)" Grid.Row="8" Grid.Column="0" Grid.ColumnSpan="2" HorizontalAlignment="Left" Checked="chkDisableBackup_CheckedChanged" Unchecked="chkDisableBackup_CheckedChanged" Margin="0,3,0,10" Background="#FFDE0E0E"/>

                    <Label x:Name="lblProcessingTool" Style="{StaticResource OptionLabelStyle}" Content="处理工具:" Grid.Row="9" Grid.Column="0" Grid.ColumnSpan="2" HorizontalAlignment="Left"/>
                    <ComboBox x:Name="cmbProcessingTool" SelectedIndex="0" Width="150" Grid.Row="10" Grid.Column="0" Grid.ColumnSpan="2" HorizontalAlignment="Left" SelectionChanged="cmbProcessingTool_SelectionChanged">
                        <ComboBoxItem Content="ExifTool (推荐)" Tag="ExifTool"/>
                        <ComboBoxItem Content="ImageMagick" Tag="ImageMagick"/>
                    </ComboBox>
                </Grid>
            </GroupBox>

            <!-- Col 2: Video/Animation Options -->
            <GroupBox x:Name="gbVideo" Header="视频/动画选项" Margin="197,0,3,0" Grid.ColumnSpan="2" Grid.Column="4">
                <StackPanel Orientation="Vertical">
                    <CheckBox x:Name="chkEnableZoompan" Style="{StaticResource OptionCheckBoxStyle}" Content="启用 ZoomPan 效果" Checked="ChkEnableZoompan_CheckedChanged" Unchecked="ChkEnableZoompan_CheckedChanged" Background="#FF26D820"/>
                    <Button x:Name="btnZoompanSettings" Style="{StaticResource BaseButtonStyle}" Content="效果设置..." IsEnabled="{Binding IsChecked, ElementName=chkEnableZoompan}" Click="BtnZoompanSettings_Click" Width="120" HorizontalAlignment="Left" Margin="0,0,0,10"/>

                    <Separator/>

                    <Label x:Name="lblOutputFormat" Style="{StaticResource OptionLabelStyle}" Content="输出格式:" Margin="0,5,0,0"/>
                    <StackPanel Orientation="Horizontal" Margin="0,3,0,10">
                        <RadioButton x:Name="rbFormatMov" Content="MOV (H.265)" GroupName="OutputFormat" IsChecked="True" Margin="0,0,10,0" VerticalAlignment="Center" Background="#FF30EA0A"/>
                        <RadioButton x:Name="rbFormatMp4" Content="MP4 (H.264)" GroupName="OutputFormat" Margin="0,0,10,0" VerticalAlignment="Center" Background="#FFFEEFFF"/>
                        <RadioButton x:Name="rbFormatGif" Content="GIF" GroupName="OutputFormat" VerticalAlignment="Center" Background="#FFBCDAE2"/>
                    </StackPanel>

                    <CheckBox x:Name="chkBurstMode" Style="{StaticResource OptionCheckBoxStyle}" Content="连拍模式 (多图转单视频/GIF)" Checked="ChkBurstMode_CheckedChanged" Unchecked="ChkBurstMode_CheckedChanged" ToolTip="将选定文件夹中的所有图片按顺序合成为一个文件。ZoomPan效果将不适用。" Background="#FF1FD21A"/>
                    <CheckBox x:Name="chkTimestampSubfolder" Style="{StaticResource OptionCheckBoxStyle}" Content="输出到时间戳子文件夹" IsChecked="True" ToolTip="Requires 'Enable Timestamp' to be checked as well." Background="#FF1ED019"/>

                    <Label x:Name="lblOutputResolution" Style="{StaticResource OptionLabelStyle}" Content="输出分辨率 (非连拍模式):"/>
                    <ComboBox x:Name="cmbOutputResolution" SelectedIndex="0" Width="150" HorizontalAlignment="Left">
                        <ComboBoxItem Content="源分辨率 (Default)" Tag="source"/>
                        <ComboBoxItem Content="1920x1080 (FHD)" Tag="1920x1080"/>
                        <ComboBoxItem Content="2560x1440 (2K)" Tag="2560x1440"/>
                        <ComboBoxItem Content="3840x2160 (4K)" Tag="3840x2160"/>
                        <ComboBoxItem Content="1080x1920 (竖屏)" Tag="1080x1920"/>
                    </ComboBox>

                    <Label x:Name="lblOutputFps" Style="{StaticResource OptionLabelStyle}" Content="输出帧率 (连拍模式):"/>
                    <ComboBox x:Name="cmbOutputFps" SelectedIndex="1" Width="150" HorizontalAlignment="Left" SelectionChanged="cmbOutputFps_SelectionChanged">
                        <ComboBoxItem x:Name="cmbFps10" Content="10 FPS" Tag="10"/>
                        <ComboBoxItem x:Name="cmbFps15" Content="15 FPS" Tag="15"/>
                        <ComboBoxItem x:Name="cmbFps24" Content="24 FPS" Tag="24"/>
                        <ComboBoxItem x:Name="cmbFps30" Content="30 FPS" Tag="30"/>
                        <ComboBoxItem x:Name="cmbFps60" Content="60 FPS" Tag="60"/>
                        <ComboBoxItem x:Name="cmbFps120" Content="120 FPS" Tag="120"/>
                    </ComboBox>
                </StackPanel>


            </GroupBox>
            <Button x:Name="btnSelectFolder" Style="{StaticResource SelectButtonStyle}" Content="📂  选择文件夹"  Click="BtnSelectFolder_Click" Background="#FFFFDE03" Grid.Column="7" Margin="35,20,386,0" VerticalAlignment="Top" Width="NaN" Height="31" BorderBrush="{x:Null}" FontWeight="Bold" Grid.ColumnSpan="2"/>

            <Button x:Name="btnSelectImages" Style="{StaticResource SelectButtonStyle}" Content="选择图片" Click="BtnSelectImages_Click" Background="#FF78E9EC" Grid.Column="7" Margin="34,68,386,0" VerticalAlignment="Top" Height="31" BorderBrush="{x:Null}" FontWeight="Bold" Grid.ColumnSpan="2"/>
            <Button x:Name="btnStartProcessing" Style="{StaticResource StartProcessingButtonStyle}" Content="运行EXIF/命名" Click="BtnStartProcessing_Click" IsEnabled="False" ToolTip="执行EXIF清理或直接重命名操作" Background="#FFA9E9E6" BorderBrush="#FFF98EB5" FontSize="13" IsDefault="True" Cursor="Arrow" Grid.Column="7" Margin="24,142,376,0" VerticalAlignment="Top" Height="45" Foreground="#FF52052F" Grid.ColumnSpan="2"/>
            <Button x:Name="btnGenerateZoompan" Style="{StaticResource GenerateButtonStyle}" Content="生成视频/动画" Click="BtnGenerateZoompan_Click" IsEnabled="{Binding IsEnabled, ElementName=btnStartProcessing}" ToolTip="根据视频/动画选项生成输出文件" FontSize="13" FontWeight="Bold" BorderBrush="#FFAFE1E9" Foreground="#FF02363B" Background="#FFFFA6CA" Grid.Column="7" Margin="24,202,376,0" VerticalAlignment="Top" Height="45" Grid.ColumnSpan="2"/>
            <Separator Grid.Column="7" Margin="24,193,376,181" Grid.ColumnSpan="2"/>
            <Separator Grid.Column="7" Margin="35,56,386,316" RenderTransformOrigin="0.5,0.5" Grid.ColumnSpan="2">
                <Separator.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleY="-1"/>
                        <SkewTransform/>
                        <RotateTransform/>
                        <TranslateTransform/>
                    </TransformGroup>
                </Separator.RenderTransform>
            </Separator>

            <!-- Col 3: Start Buttons -->
        </Grid>

        <!-- Row 2, 3, 4: Custom Paths in their own GroupBox -->
        <GroupBox x:Name="Pathname" Grid.Row="2" Header="自定义路径选项 (✔优先可选) " Foreground="#FF39BA1D" Margin="0,3,0,2" HorizontalAlignment="Center" Width="1525"  >
            <StackPanel Orientation="Vertical">
                <!-- Custom Backup Path -->
                <Grid Margin="{StaticResource SectionMargin}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="BrowseButtonGroup"/>
                    </Grid.ColumnDefinitions>
                    <CheckBox x:Name="chkUseCustomBackupPath2" Style="{StaticResource OptionCheckBoxStyle}" Content="自定义备份输出路径" Grid.Column="0" Checked="chkUseCustomBackupPath2_CheckedChanged" Unchecked="chkUseCustomBackupPath2_CheckedChanged" Background="#FF1BDE15"/>
                    <TextBox x:Name="txtCustomBackupPath2" Style="{StaticResource OptionTextBoxStyle}" Grid.Column="1" IsEnabled="{Binding IsChecked, ElementName=chkUseCustomBackupPath2}" Margin="5,3,5,3"/>
                    <Button x:Name="btnSelectCustomBackupPath" Style="{StaticResource BrowseButtonStyle}" Grid.Column="2" Content="浏览输出文件夹" Click="btnSelectCustomBackupPath_Click" IsEnabled="{Binding IsChecked, ElementName=chkUseCustomBackupPath2}"/>
                </Grid>
                <!-- Custom Image Output Path -->
                <Grid Margin="{StaticResource SectionMargin}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="BrowseButtonGroup"/>
                    </Grid.ColumnDefinitions>
                    <CheckBox x:Name="chkUseCustomImageOutputPath" Style="{StaticResource OptionCheckBoxStyle}" Content="自定义图像输出路径" Grid.Column="0" ToolTip="将EXIF处理后的图像输出到指定文件夹，而不是原始位置。" Checked="ChkUseCustomImageOutputPath_CheckedChanged" Unchecked="ChkUseCustomImageOutputPath_CheckedChanged" Background="#FF40D621"/>
                    <TextBox x:Name="txtCustomImageOutputPath" Style="{StaticResource OptionTextBoxStyle}" Grid.Column="1" IsEnabled="{Binding IsChecked, ElementName=chkUseCustomImageOutputPath}" Margin="5,3,5,3"/>
                    <Button x:Name="btnSelectCustomImageOutputPath" Style="{StaticResource BrowseButtonStyle}" Grid.Column="2" Content="浏览输出文件夹" Click="btnSelectCustomImageOutputPath_Click" IsEnabled="{Binding IsChecked, ElementName=chkUseCustomImageOutputPath}"/>
                </Grid>
                <!-- Custom Video Output Path -->
                <Grid Margin="{StaticResource SectionMargin}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto" SharedSizeGroup="BrowseButtonGroup"/>
                    </Grid.ColumnDefinitions>
                    <CheckBox x:Name="chkUseCustomVideoOutputPath" Style="{StaticResource OptionCheckBoxStyle}" Content="自定义视频输出路径" Grid.Column="0" ToolTip="将生成的视频/动画输出到指定文件夹，而不是默认的 'Output' 文件夹。" Checked="ChkUseCustomVideoOutputPath_CheckedChanged" Unchecked="ChkUseCustomVideoOutputPath_CheckedChanged" Background="#FF32D611"/>
                    <TextBox x:Name="txtCustomVideoOutputPath" Style="{StaticResource OptionTextBoxStyle}" Grid.Column="1" IsEnabled="{Binding IsChecked, ElementName=chkUseCustomVideoOutputPath}" Margin="5,3,5,3"/>
                    <Button x:Name="btnSelectCustomVideoOutputPath" Style="{StaticResource BrowseButtonStyle}" Grid.Column="2" Content="浏览输出文件夹" Click="btnSelectCustomVideoOutputPath_Click" IsEnabled="{Binding IsChecked, ElementName=chkUseCustomVideoOutputPath}"/>
                </Grid>
            </StackPanel>
        </GroupBox>


        <!-- Row 5: Drop Area -->
        <Border Style="{StaticResource DropBorderStyle}" Grid.Row="3" DragEnter="Panel_DragEnter" DragLeave="Panel_DragLeave" Drop="Panel_DragDrop" Margin="0,3,0,5">
            <TextBlock Style="{StaticResource DropTextStyle}" Text="拖动文件夹或图像到此处"/>
        </Border>

        <!-- Row 6: Progress Bar -->
        <Grid Grid.Row="4" Margin="0,5,0,2">
            <Grid.OpacityMask>
                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                    <GradientStop Color="Black"/>
                    <GradientStop Color="White" Offset="1"/>
                </LinearGradientBrush>
            </Grid.OpacityMask>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Label Content="处理进度&gt;&gt;&gt;" Grid.Column="0" VerticalAlignment="Center" Padding="5,0,3,0"/>
            <ProgressBar x:Name="progressBar"
             Grid.Column="1"
             Height="18"
             Minimum="0"
             Maximum="100"
             Margin="5,0,0,0"
             IsIndeterminate="False"
             Background="#00000000"
             Foreground="#FF4CAF50"
             ValueChanged="progressBar_ValueChanged">

                <ProgressBar.Template>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid Height="18">
                            <!-- 子弹头圆角外边框 -->
                            <Border BorderThickness="1" CornerRadius="37">
                                <Border.BorderBrush>
                                    <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                        <GradientStop Color="#FF00FF00" Offset="1"/>
                                        <GradientStop Color="#00000000" Offset="0"/>
                                    </LinearGradientBrush>
                                </Border.BorderBrush>
                                <Border.Background>
                                    <SolidColorBrush Color="#00000000"/>
                                </Border.Background>
                            </Border>

                            <!-- 内容轨道 -->
                            <Grid x:Name="PART_Track" ClipToBounds="True">
                                <!-- 填充箭头图案 -->
                                <Rectangle x:Name="PART_Indicator"
                               Height="18"
                               RadiusX="12" RadiusY="12"
                               HorizontalAlignment="Left">
                                    <Rectangle.Fill>
                                        <VisualBrush TileMode="Tile"
                                         Viewport="0,0,20,18"
                                         ViewportUnits="Absolute"
                                         Viewbox="0,0,20,18"
                                         ViewboxUnits="Absolute">
                                            <VisualBrush.Visual>
                                                <Canvas Width="20" Height="18">
                                                    <!-- 箭头填充 -->
                                                    <Polygon Points="0,0 16,9 0,18">
                                                        <!-- 颜色渐变 -->
                                                        <Polygon.Fill>
                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                <GradientStop Color="#4CAF50" Offset="0"/>
                                                                <GradientStop Color="#A5D6A7" Offset="0.5"/>
                                                                <GradientStop Color="#00FF00" Offset="1"/>
                                                            </LinearGradientBrush>
                                                        </Polygon.Fill>

                                                        <!-- 透明度渐变 -->
                                                        <Polygon.OpacityMask>
                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                <GradientStop Color="White" Offset="0"/>
                                                                <GradientStop Color="#00FFFFFF" Offset="1"/>
                                                            </LinearGradientBrush>
                                                        </Polygon.OpacityMask>
                                                    </Polygon>
                                                </Canvas>
                                            </VisualBrush.Visual>
                                        </VisualBrush>
                                    </Rectangle.Fill>
                                </Rectangle>
                            </Grid>
                        </Grid>
                    </ControlTemplate>
                </ProgressBar.Template>
            </ProgressBar>

        </Grid>

        <!-- Row 7: Log Label -->
        <Label x:Name="LogLabelElement" Content="处理日志:" Grid.Row="5" Padding="5,2,0,2" Height="24" VerticalAlignment="Center" FontWeight="SemiBold"/>

        <!-- Row 8: Log Area -->
        <TextBox x:Name="TbLog" Grid.Row="5" VerticalScrollBarVisibility="Auto" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" FontFamily="Consolas" FontSize="11" BorderThickness="1" BorderBrush="DarkGray" TextChanged="TbLog_TextChanged" Padding="5" Margin="0,24,0,5" Grid.RowSpan="2"/>
        <MenuItem x:Name="clearLogItem" Header="清除日志" Click="ClearLog_Click" Margin="246,25,642,0" Grid.Row="4" Grid.RowSpan="2"/>
        <MenuItem x:Name="saveLogItem" Header="保存日志" Click="SaveLog_Click" Margin="94,25,794,5" Grid.Row="4" Grid.RowSpan="2"/>
        <!-- Added bottom margin -->

        <!-- Row 9: Status Bar -->
        <StatusBar Grid.Row="7" Height="24" VerticalAlignment="Center">
            <!-- Increased height slightly -->
            <StatusBarItem>
                <TextBlock x:Name="lblProcessStatus" Text="Ready"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblImageCount" Text="Selected Items: 0"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblProgressHint" Text="Progress:"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblStartTime" Text="Start: -"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblEndTime" Text="End: -"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblElapsedTime" Text="Elapsed: -"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblTotalTime" Text="Total: -"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="lblConcurrentTasks" Text="Concurrent: 0"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem DockPanel.Dock="Right">
                <TextBlock x:Name="lblRealTimeClock" Text="00:00:00" HorizontalAlignment="Left" TextAlignment="Right"/>
            </StatusBarItem>
        </StatusBar>

    </Grid>
</Window>